name: Build .NET Framework Solution
          
on:
  workflow_dispatch:
    inputs:
      configuration:
        description: 'Build Configuration'
        required: true
        default: 'Release'
        type: choice
        options:
          - Debug
          - Release
          
jobs:
  build:
    # Use a Windows runner, which is required for full .NET Framework
    runs-on: windows-latest
          
    env:
      # Define the name of your solution file
      SOLUTION_FILE: Rubeus.sln
      # Set the build configuration from the user input
      BUILD_CONFIG: ${{ github.event.inputs.configuration }}
          
    steps:
      # Step 1: Checkout the repository code
      - name: Checkout Code
        uses: actions/checkout@v4
          
      # Step 2: Set up the correct version of MSBuild and Visual Studio
      # This makes the 'msbuild.exe' command available in the path
      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2
          
      # Step 3: Restore NuGet dependencies
      - name: Restore NuGet Packages
        run: nuget restore ${{ env.SOLUTION_FILE }}
          
      # Step 4: Build the Solution file
      # FIX: Add /p:TargetFrameworkVersion=v4.8 to override v4.0.
      # The windows-latest runner is guaranteed to have the v4.8 targeting pack.
      - name: Build Solution (Override Framework)
        run: |
          msbuild.exe ${{ env.SOLUTION_FILE }} /p:Configuration=${{ env.BUILD_CONFIG }} /p:Platform="Any CPU" /t:Build /p:TargetFrameworkVersion=v4.8
          
      # Step 5: Upload the compiled files (the 'Artifact')
      # FIX: Use ${{ env.BUILD_CONFIG }} variable to dynamically select Debug/Release folder
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.BUILD_CONFIG }}-Rubeus
          # The path uses the dynamic BUILD_CONFIG variable
          path: Rubeus/bin/${{ env.BUILD_CONFIG }}/Rubeus.exe
